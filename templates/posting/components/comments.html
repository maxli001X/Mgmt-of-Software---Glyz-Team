{% load posting_tags %}

{# Display comments for a post #}
<div class="comments-section" data-post-id="{{ post.pk }}">
    <h4 class="comments-header">
        Comments ({{ post.visible_comments_count|default:0 }})
    </h4>

    {# Add comment form #}
    {% if user.is_authenticated %}
    <form method="post" action="{% url 'posting:add_comment' post.pk %}" class="comment-form">
        {% csrf_token %}
        <textarea
            name="body"
            rows="2"
            class="comment-textarea"
            placeholder="Add a comment..."
            required
            aria-label="Add comment"
        ></textarea>
        <div class="comment-form-actions">
            <label class="comment-anonymous-label">
                <input type="checkbox" name="is_anonymous" checked class="form-checkbox">
                <span>Post anonymously</span>
            </label>
            <button type="submit" class="comment-submit-btn">Post Comment</button>
        </div>
    </form>
    {% endif %}

    {# List of comments #}
    <div class="comments-list">
        {% for comment in post.comments.all %}
            {% if not comment.parent_comment %}
                {% include "posting/components/comment_item.html" with comment=comment user_comment_votes=user_comment_votes %}
            {% endif %}
        {% empty %}
        <p class="no-comments">No comments yet. Be the first to comment!</p>
        {% endfor %}
    </div>
</div>
