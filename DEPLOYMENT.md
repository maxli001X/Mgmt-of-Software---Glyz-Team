# Tree Hole Yale - Render Deployment Guide

This guide will help you deploy the Tree Hole Yale application to Render using the Blueprint specification.

## Prerequisites

1. A [Render account](https://render.com) (free tier works)
2. A GitHub repository with your code
3. PostgreSQL database (automatically created via Blueprint)

## Deployment Methods

### Method 1: Deploy via Render Dashboard (Recommended)

1. **Push your code to GitHub**
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing this project
   - Render will automatically detect the `render.yaml` file

3. **Configure Service Name (Optional)**
   - Review the service name: `glyz-team`
   - You can customize it in `render.yaml` if needed
   - The URL will be: `https://glyz-team.onrender.com`

4. **Deploy**
   - Click "Apply" to create the services
   - Render will:
     - Create a PostgreSQL database (`glyz-team-db`)
     - Create a web service
     - Install dependencies
     - Run migrations
     - Collect static files
     - Start the application

### Method 2: Deploy via Render CLI

1. **Install Render CLI**
   ```bash
   brew install render  # macOS
   # or download from https://render.com/docs/cli
   ```

2. **Login to Render**
   ```bash
   render login
   ```

3. **Deploy Blueprint**
   ```bash
   render blueprint launch
   ```

## Configuration Files

### `render.yaml` (Blueprint Specification)
- Defines your web service and database
- Configures environment variables
- Sets up build and deploy commands

### `runtime.txt`
- Specifies Python version (3.12.0)

### `.renderignore`
- Excludes unnecessary files from deployment

### `build.sh`
- Optional build script for more complex setups

## Environment Variables

The following environment variables are automatically configured via `render.yaml`:

| Variable | Description | Default Value |
|----------|-------------|---------------|
| `DJANGO_SECRET_KEY` | Auto-generated secure key | Generated by Render |
| `DJANGO_ALLOWED_HOSTS` | Allowed hostnames | `glyz-team.onrender.com,.onrender.com` |
| `DJANGO_CSRF_TRUSTED_ORIGINS` | CSRF trusted origins | `https://glyz-team.onrender.com` |
| `DJANGO_DEBUG` | Debug mode | `False` |
| `DATABASE_URL` | PostgreSQL connection string | Auto-configured from database |
| `DB_SSL_REQUIRE` | Require SSL for database | `True` |
| `ALLOWED_EMAIL_DOMAINS` | Allowed email domains | `yale.edu` |

### Additional Environment Variables (Optional)

You can add these manually in the Render Dashboard if needed:

- `DJANGO_SESSION_COOKIE_SAMESITE`: Cookie SameSite policy (default: `Lax`)
- `DJANGO_HSTS_SECONDS`: HTTP Strict Transport Security duration (default: `31536000`)
- `EMAIL_BACKEND`: Email backend configuration

## Customizing Your Deployment

### Change Service Name

Edit `render.yaml`:
```yaml
services:
  - type: web
    name: your-custom-name  # Change this
```

And update the corresponding environment variables:
```yaml
- key: DJANGO_ALLOWED_HOSTS
  value: your-custom-name.onrender.com,.onrender.com
- key: DJANGO_CSRF_TRUSTED_ORIGINS
  value: https://your-custom-name.onrender.com
```

Don't forget to update the database name reference as well.

### Upgrade to Paid Plan

For better performance, upgrade to a paid plan in `render.yaml`:

```yaml
services:
  - type: web
    plan: starter  # or standard, pro, etc.

databases:
  - name: glyz-team-db
    plan: starter  # or standard, pro, etc.
```

### Custom Domain

1. Add your custom domain in Render Dashboard
2. Update `DJANGO_ALLOWED_HOSTS` and `DJANGO_CSRF_TRUSTED_ORIGINS` to include your domain

## Post-Deployment Tasks

### Create a Superuser

1. Go to Render Dashboard → Your Web Service → Shell
2. Run:
   ```bash
   python manage.py createsuperuser
   ```

### Access Admin Panel

Visit: `https://glyz-team.onrender.com/admin/`

## Monitoring and Logs

- **View Logs**: Render Dashboard → Your Service → Logs
- **Health Checks**: Automatic health checks at `/` endpoint
- **Metrics**: Available in Render Dashboard

## Troubleshooting

### Build Fails

1. Check Python version compatibility in `runtime.txt`
2. Verify all dependencies are in `requirements.txt`
3. Review build logs in Render Dashboard

### Database Connection Issues

1. Ensure `DATABASE_URL` is properly linked
2. Verify `DB_SSL_REQUIRE=True` for Render PostgreSQL
3. Check database is in the same region as web service

### Static Files Not Loading

1. Verify `whitenoise` is in `requirements.txt`
2. Check `STATIC_ROOT` is correctly set in `settings.py`
3. Ensure `collectstatic` runs in `preDeployCommand`

### 502 Bad Gateway

1. Check if migrations ran successfully
2. Verify Gunicorn is starting properly
3. Review application logs for errors

## Free Tier Limitations

- **Web Service**: Spins down after 15 minutes of inactivity
- **Database**: 1GB storage, expires after 90 days
- **Cold Starts**: First request after spin-down may take 30-60 seconds

## Upgrading to Production

For production use, consider:

1. **Upgrade Plans**: Use paid plans for better performance and no spin-down
2. **Environment Variables**: Review and strengthen security settings
3. **Database Backups**: Enable automated backups
4. **Custom Domain**: Add your own domain
5. **CDN**: Consider using a CDN for static files
6. **Email**: Configure a production email backend (SendGrid, Mailgun, etc.)
7. **Error Monitoring**: Add Sentry or similar service

## Security Checklist

- ✅ `DEBUG=False` in production
- ✅ Strong `SECRET_KEY` (auto-generated)
- ✅ SSL enabled (`SECURE_SSL_REDIRECT=True`)
- ✅ Secure cookies enabled
- ✅ HSTS enabled for HTTPS
- ✅ Database SSL required
- ✅ CSRF protection enabled
- ✅ Limited to `yale.edu` email domains

## Continuous Deployment

With `autoDeploy: true` in `render.yaml`:
- Automatic deployments on git push to main branch
- Can disable in Render Dashboard if needed

## Support

- **Render Documentation**: https://render.com/docs
- **Django on Render**: https://render.com/docs/deploy-django
- **Community Support**: https://community.render.com

## Useful Commands

```bash
# View logs
render logs

# Run shell commands
render shell

# Force redeploy
render deploy

# View service info
render services list
```

---

**Note**: The service is configured with the name `glyz-team` for the URL `https://glyz-team.onrender.com`. You can customize this in `render.yaml` if you want a different URL.

